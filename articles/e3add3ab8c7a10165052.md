---
title: "ã€CarrierWaveã€‘Nuxt.js+Railsã§ç”»åƒã‚’ä¿å­˜ã•ã›ãŸã„æ™‚ã«ã‚„ã£ãŸã“ã¨"
emoji: "ğŸ¦"
type: "tech"
topics: ["nuxtjs", "rails", "åˆå¿ƒè€…", "carrierwave"]
published: true
---

ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚¹ã‚¯ãƒ¼ãƒ«å’æ¥­å¾Œã«ã€Railsã®APIãƒ¢ãƒ¼ãƒ‰ã§é–‹ç™ºã‚’ã—ãŸã„ã¨æ€ã„ã€ãƒ•ãƒ­ãƒ³ãƒˆã«Nuxt.jsã‚’ä½¿ã£ã¦å‹‰å¼·ã—ãªãŒã‚‰å®Ÿè£…ã—ã¦ã„ã‚‹ã€‚ä»Šå›ã¯carrierwaveã‚’ä½¿ã£ã¦ç”»åƒã‚’ä¿å­˜ã™ã‚‹ã“ã¨ãŒã§ããŸã®ã§å¿˜ã‚Œãªã„ã‚ˆã†ã«æ›¸ã„ã¦ãŠãã€‚ã¡ãªã¿ã«axiosã‚„carrierwaveã®å°å…¥ã®èª¬æ˜ã¯çœãã€‚
# å¿…è¦ãªã‚‚ã®
axiosã¨cors(APIé€šä¿¡)
carrierwave(ç”»åƒï¼‰
# å®Ÿè£…
## Rails
### ãƒ¢ãƒ‡ãƒ«
carrierwaveã‚’å°å…¥ã—ã€uploaderã‚’ä½œæˆå¾Œ
postãƒ¢ãƒ‡ãƒ«ã®imageã‚«ãƒ©ãƒ ã«ImageUploaderã‚’æŒ‡å®šã™ã‚‹
uploaderåã¯Imageã¨ã—ãŸ
```ruby:post.rb
mount_uploader :image, ImageUploader
```
### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©
createãŒæˆåŠŸãªã®ã‹å¤±æ•—ãªã®ã‹ã«ã‚ˆã£ã¦è¿”ã™JSONã‚’æ¡ä»¶åˆ†å²ã™ã‚‹ã€‚

```ruby:post_controller.rb

  def create
    @post = Post.new(post_params)
    if @post.save
      render json: @post
    else
      render json: @post.errors, status: :unprocessable_entity
    end
  end 
  
  
  ```

## Nuxt
### template
ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã«vuetifyã‚’ä½¿ç”¨

```vue:post.vue
<template>
 <div>
  <v-file-input   
  <!-- ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸæ™‚ã«"setImage"ãŒç™ºç«ã™ã‚‹ã‚ˆã†ã«è¨˜è¿° -->
   @change="setImage"
   label="ç”»åƒ"
   accept="image/png, image/jpeg, image/bmp"
  />
  <v-btn 
  <!-- æŠ•ç¨¿ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ -->
   @click="createPost" 
  >
  æŠ•ç¨¿ã™ã‚‹
  </v-btn>
 </div>
</template>
```
### script
ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸæ™‚ã€setImageã«ã‚ˆã£ã¦imageã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ ¼ç´ã•ã‚Œã‚‹ã€‚
æŠ•ç¨¿ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã€
1.createPostã§Formdataã‚’ä½œã‚Šãã®ä¸­ã«imageã‚’å…¥ã‚Œã‚‹ã€‚
2.content-type": "multipart/form-data"ã‚’headerã«å…¥ã‚Œã‚‹
3.axiosã§postã™ã‚‹
```vue:post.vue
<script>
 export default {
  data(){
   return{
    image:""
   }
  },
  methods:{
   setImage(e){
    this.image = e;
   },
   createPost(){
    const formData = new FormData();
    formData.append("image", this.image);
    const config = {
     headers: {
      "content-type": "multipart/form-data",
     }
    };
    this.$axios.post("æŒ‡å®šã®URL("/api/v1/spots"ãªã©)",
     formData,config
    )
    // æˆåŠŸæ™‚ã®å‡¦ç†
    .then(res => {
    })
    // å¤±æ•—æ™‚ã®å‡¦ç†
    .catch((error) => {
    })
   }
  }
 }
</script>
```
# ã¾ã¨ã‚
file-inputã«é¸æŠã•ã‚ŒãŸç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’imageã¸æ ¼ç´ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä½œã‚‹
æŠ•ç¨¿ãƒœã‚¿ãƒ³ã§ã€formDataã¨headerã‚’axiosã§Railsã«é€ä¿¡ã™ã‚‹